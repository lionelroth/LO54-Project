<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<h:head>
		<title>Session List</title>
		<style>
            .tableTest { height: 200%; margin-bottom:10px; }
            .tableTest tr td{
 	    		height: 35px;  
			}
			
        </style>
	</h:head>
	<h:body>
		<ui:composition template="/template/baseLayout.xhtml">
			<ui:define name="content">
			
			<p:steps styleClass="custom" activeIndex="1" readonly="false">
				 <p:menuitem value="#{navigationController.pageLabels.get(0)}" url="#{navigationController.pageUrls.get(0)}"/>
				 <p:menuitem value="#{navigationController.pageLabels.get(1)}" url="#{navigationController.pageUrls.get(1)}"/>
				 <p:menuitem value="#{navigationController.pageLabels.get(2)}" url="#{navigationController.pageUrls.get(2)}"/>
				 <p:menuitem value="#{navigationController.pageLabels.get(3)}" url="#{navigationController.pageUrls.get(3)}"/>
			</p:steps>
				<p:panel header="Filter" styleClass="tableTest" toggleable="true">
					<h:form>
				
						<h:panelGrid id="panelId" columns="3" cellpadding="5">
							<p:selectBooleanCheckbox id="codeFilterCheckbox" value="#{sessionListController.courseCodeFilterSelected}" />
							<p:outputLabel value="Recherche par code de formation "/>
							<p:inputText id="researchCodeInput" value="#{sessionListController.courseCodeFilter}">
								<p:ajax event="change" listener="#{sessionListController.codeSearchUpdated}" update="codeFilterCheckbox" />
							</p:inputText>
							
							<p:selectBooleanCheckbox id="titleFilterCheckbox" value="#{sessionListController.courseTitleFilterSelected}"/>
							<h:outputText value="Recherche par mot-clé du titre "/>
							<p:inputText value="#{sessionListController.courseTitleFilter}">
								<p:ajax event="change" listener="#{sessionListController.titleSearchUpdated}" update="titleFilterCheckbox" />
							</p:inputText>
							
							<p:selectBooleanCheckbox id="dateMiniCheckbox" value="#{sessionListController.dateMiniSeleted}" />
							<h:outputText value="Date Debut minimum : "/>
							<p:calendar value="#{sessionListController.dateMini}" >
								<p:ajax event="dateSelect" listener="#{sessionListController.dateMiniUpdated}" update="dateMiniCheckbox" />
							</p:calendar>
							
							<p:selectBooleanCheckbox id="dateMaxiCheckbox" value="#{sessionListController.dateMaxiSeleted}" />
							<h:outputText value="Date Fin maximum : "/>
							<p:calendar value="#{sessionListController.dateMaxi}">
								<p:ajax event="dateSelect" listener="#{sessionListController.dateMaxiUpdated}" update="dateMaxiCheckbox" />
							</p:calendar>
							
							<p:selectBooleanCheckbox id="locationFilterCheckbox" value="#{sessionListController.locationFilterSelected}" immediate="true"/>
							<h:outputText value="Recherche par lieux "/>
							<p:selectCheckboxMenu
							value="#{sessionListController.selectedLocations}"
							converter="locationConverter"
							filter="true" filterMatchMode="startsWith"
							label="Villes">
								<f:selectItems value="#{sessionListController.locationList}" var="location" itemValue="#{location}" itemLabel="#{location.city}"/>
								<p:ajax event="change" listener="#{sessionListController.locationFilterUpdated}" update="locationFilterCheckbox" />
							</p:selectCheckboxMenu>
							
						</h:panelGrid>
			
						<p:commandButton type="submit" value="Rechercher" update="results" actionListener="#{sessionListController.computeFilter}"/>
					</h:form>
				</p:panel>
				
				
				
				<p:panel id="results" header="#{sessionListController.searchRecap}" styleClass="tableTest">	
					<h:form>
					    <p:dataTable id="dataList" value="#{sessionListController.selectedCourseSessionList}" var="courseSession" sortBy="#{courseSession.course.code}" 
					    emptyMessage="Aucun résulat" draggableColumns="true" stickyHeader="true">
					        
					        <p:column headerText="Code" style="width:110px" sortBy="#{courseSession.course.code}"
					        	filterBy="#{courseSession.course.code}" filterMatchMode="contains">
					        	<h:outputText value="#{courseSession.course.code}"/>
				        	</p:column>
				        	<p:column headerText="Titre" sortBy="#{courseSession.course.title}"
				        		filterBy="#{courseSession.course.title}" filterMatchMode="contains">
					        	<h:outputText value="#{courseSession.course.title}"/>
					        </p:column>
					        <p:column headerText="Ville" sortBy="#{courseSession.location.city}"
					        	filterBy="#{courseSession.location.city}" filterMatchMode="contains">
					        	<h:outputText value="#{courseSession.location.city}"/>
				        	</p:column>
				        	<p:column headerText="Dates" sortBy="#{courseSession.startDate}">
					        	<h:outputText value="#{courseSession.startDate} / #{courseSession.endDate}"/>
				        	</p:column>
				        	<p:column headerText="Inscription" style="width:200px; text-align:center">
					        	<p:commandButton value="S'inscrire à ce cours&#10;#{sessionListController.getRegisteredNumberForSession(courseSession.id)} inscrit(s)" 
					        		style="white-space: pre;" action="#{subscriptionController.updateSubscriptionSession(courseSession.id)}">
				        		</p:commandButton>
				        	</p:column>
				        	
				        	<f:facet name="footer">
								#{sessionListController.selectedCourseSessionList.size()} formation(s) proposée(s).
							</f:facet>
							
					    </p:dataTable>
					</h:form>
				</p:panel>
			</ui:define>
		</ui:composition>
	</h:body>
</html>
